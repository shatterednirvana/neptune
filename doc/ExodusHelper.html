<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>module ExodusHelper - RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/exodus.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-average">::average</a>
    
    <li><a href="#method-c-convert_clouds_to_use_to_array">::convert_clouds_to_use_to_array</a>
    
    <li><a href="#method-c-ensure_all_jobs_are_hashes">::ensure_all_jobs_are_hashes</a>
    
    <li><a href="#method-c-ensure_all_params_are_present">::ensure_all_params_are_present</a>
    
    <li><a href="#method-c-ensure_credentials_are_in_correct_format">::ensure_credentials_are_in_correct_format</a>
    
    <li><a href="#method-c-find_optimal_cloud_for_task">::find_optimal_cloud_for_task</a>
    
    <li><a href="#method-c-generate_babel_tasks">::generate_babel_tasks</a>
    
    <li><a href="#method-c-get_clouds_to_run_task_on">::get_clouds_to_run_task_on</a>
    
    <li><a href="#method-c-get_key_from_job_data">::get_key_from_job_data</a>
    
    <li><a href="#method-c-get_minimum_val_in_data">::get_minimum_val_in_data</a>
    
    <li><a href="#method-c-get_profiling_info">::get_profiling_info</a>
    
    <li><a href="#method-c-propogate_credentials_from_environment">::propogate_credentials_from_environment</a>
    
    <li><a href="#method-c-run_job">::run_job</a>
    
    <li><a href="#method-c-validate_clouds_to_use">::validate_clouds_to_use</a>
    
    <li><a href="#method-c-validate_files_argv_executable">::validate_files_argv_executable</a>
    
    <li><a href="#method-c-validate_optimize_for_param">::validate_optimize_for_param</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./BabelHelper.html">BabelHelper</a>
  
    <li><a href="./BadConfigurationException.html">BadConfigurationException</a>
  
    <li><a href="./CommonFunctions.html">CommonFunctions</a>
  
    <li><a href="./ExodusHelper.html">ExodusHelper</a>
  
    <li><a href="./ExodusTaskInfo.html">ExodusTaskInfo</a>
  
    <li><a href="./FileNotFoundException.html">FileNotFoundException</a>
  
    <li><a href="./NeptuneHelper.html">NeptuneHelper</a>
  
    <li><a href="./NeptuneManagerClient.html">NeptuneManagerClient</a>
  
    <li><a href="./NeptuneManagerException.html">NeptuneManagerException</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./TaskInfo.html">TaskInfo</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module ExodusHelper</h1>

  <div id="description" class="description">
    
<p>This module provides convenience functions for exodus(), to avoid
cluttering up <a href="Object.html">Object</a> or Kernel’s namespace.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="CLOUD_BABEL_PARAMS">CLOUD_BABEL_PARAMS
        
        <dd class="description">
        
      
        <dt id="CLOUD_CREDENTIALS">CLOUD_CREDENTIALS
        
        <dd class="description">
        
      
        <dt id="GET_CPU_INFO">GET_CPU_INFO
        
        <dd class="description"><p>The command that we can run to get information about the number and speed
of CPUs on this machine.</p>
        
      
        <dt id="NEPTUNE_DATA_DIR">NEPTUNE_DATA_DIR
        
        <dd class="description"><p>The location on this machine where we can read and write profiling
information about jobs.</p>
        
      
        <dt id="OPTIMIZE_FOR_CHOICES">OPTIMIZE_FOR_CHOICES
        
        <dd class="description">
        
      
        <dt id="SUPPORTED_CLOUDS">SUPPORTED_CLOUDS
        
        <dd class="description"><p>A list of clouds that users can run tasks on via Exodus.</p>
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-average" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">average</span><span
            class="method-args">(vals)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Given an Array of values, calculates and returns their average.</p>
          

          
          <div class="method-source-code" id="average-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 316</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">average</span>(<span class="ruby-identifier">vals</span>)
  <span class="ruby-identifier">sum</span> = <span class="ruby-identifier">vals</span>.<span class="ruby-identifier">reduce</span>(<span class="ruby-value">0.0</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">running_total</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">running_total</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">val</span>
  }

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">sum</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">vals</span>.<span class="ruby-identifier">length</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- average-source -->
          
        </div>

        

        
      </div><!-- average-method -->

    
      <div id="method-c-convert_clouds_to_use_to_array" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">convert_clouds_to_use_to_array</span><span
            class="method-args">(job)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Given a single Exodus job, checks to make sure it has either an Array of
Strings or a single String listing the clouds that a given task can run on.
Raises a <a
href="BadConfigurationException.html">BadConfigurationException</a> if
:clouds_to_use is not in the right format.</p>
          

          
          <div class="method-source-code" id="convert_clouds_to_use_to_array-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">convert_clouds_to_use_to_array</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-identifier">clouds_class</span> = <span class="ruby-identifier">job</span>[<span class="ruby-value">:clouds_to_use</span>].<span class="ruby-identifier">class</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">clouds_class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Symbol</span>
    <span class="ruby-identifier">job</span>[<span class="ruby-value">:clouds_to_use</span>] = [<span class="ruby-identifier">job</span>[<span class="ruby-value">:clouds_to_use</span>]]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">clouds_class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
    <span class="ruby-identifier">job</span>[<span class="ruby-value">:clouds_to_use</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cloud</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Symbol</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{cloud} was not a String, &quot;</span> <span class="ruby-operator">+</span>
          <span class="ruby-node">&quot;but was a #{cloud.class}&quot;</span>)
      <span class="ruby-keyword">end</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{job[:clouds_to_use]} was not &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;a String or Array, but was a #{clouds_class}&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- convert_clouds_to_use_to_array-source -->
          
        </div>

        

        
      </div><!-- convert_clouds_to_use_to_array-method -->

    
      <div id="method-c-ensure_all_jobs_are_hashes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ensure_all_jobs_are_hashes</span><span
            class="method-args">(jobs)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Given an Array of jobs to run, ensures that they are all Hashes, the
standard format for Neptune jobs.</p>
          

          
          <div class="method-source-code" id="ensure_all_jobs_are_hashes-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 110</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ensure_all_jobs_are_hashes</span>(<span class="ruby-identifier">jobs</span>)
  <span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">job</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">job</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Hash</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;A job passed to exodus() was &quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-node">&quot;not a Hash, but was a #{job.class}&quot;</span>)
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- ensure_all_jobs_are_hashes-source -->
          
        </div>

        

        
      </div><!-- ensure_all_jobs_are_hashes-method -->

    
      <div id="method-c-ensure_all_params_are_present" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ensure_all_params_are_present</span><span
            class="method-args">(job)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Given an Exodus job, validates its parameters, raising a  <a
href="BadConfigurationException.html">BadConfigurationException</a> for any
missing params.</p>
          

          
          <div class="method-source-code" id="ensure_all_params_are_present-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ensure_all_params_are_present</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">job</span>[<span class="ruby-value">:clouds_to_use</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;:clouds_to_use was not specified&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">convert_clouds_to_use_to_array</span>(<span class="ruby-identifier">job</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">validate_clouds_to_use</span>(<span class="ruby-identifier">job</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">validate_optimize_for_param</span>(<span class="ruby-identifier">job</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">validate_files_argv_executable</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ensure_all_params_are_present-source -->
          
        </div>

        

        
      </div><!-- ensure_all_params_are_present-method -->

    
      <div id="method-c-ensure_credentials_are_in_correct_format" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ensure_credentials_are_in_correct_format</span><span
            class="method-args">(job)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="ensure_credentials_are_in_correct_format-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 180</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ensure_credentials_are_in_correct_format</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">job</span>[<span class="ruby-value">:credentials</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;No credentials were specified.&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">job</span>[<span class="ruby-value">:credentials</span>].<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Hash</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;Credentials given were not a &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;Hash, but were a #{job[:credentials].class}&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ensure_credentials_are_in_correct_format-source -->
          
        </div>

        

        
      </div><!-- ensure_credentials_are_in_correct_format-method -->

    
      <div id="method-c-find_optimal_cloud_for_task" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_optimal_cloud_for_task</span><span
            class="method-args">(job, profiling_info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="find_optimal_cloud_for_task-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 325</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_optimal_cloud_for_task</span>(<span class="ruby-identifier">job</span>, <span class="ruby-identifier">profiling_info</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_optimal_cloud_for_task-source -->
          
        </div>

        

        
      </div><!-- find_optimal_cloud_for_task-method -->

    
      <div id="method-c-generate_babel_tasks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">generate_babel_tasks</span><span
            class="method-args">(job, clouds_to_run_task_on)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="generate_babel_tasks-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 330</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">generate_babel_tasks</span>(<span class="ruby-identifier">job</span>, <span class="ruby-identifier">clouds_to_run_task_on</span>)
  <span class="ruby-identifier">tasks</span> = []

  <span class="ruby-identifier">clouds_to_run_task_on</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cloud</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">task</span> = { <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;babel&quot;</span>,
      <span class="ruby-value">:code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">job</span>[<span class="ruby-value">:code</span>],
      <span class="ruby-value">:argv</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">job</span>[<span class="ruby-value">:argv</span>],
      <span class="ruby-value">:executable</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">job</span>[<span class="ruby-value">:executable</span>],
      <span class="ruby-value">:is_remote</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>,
      <span class="ruby-value">:run_local</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
    }

    <span class="ruby-constant">CLOUD_CREDENTIALS</span>[<span class="ruby-identifier">cloud</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">credential</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">task</span>[<span class="ruby-identifier">credential</span>] = <span class="ruby-identifier">job</span>[<span class="ruby-value">:credentials</span>][<span class="ruby-identifier">credential</span>]
    }

    <span class="ruby-identifier">task</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-constant">CLOUD_BABEL_PARAMS</span>[<span class="ruby-identifier">cloud</span>])
    <span class="ruby-identifier">tasks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">task</span>
  }

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">tasks</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- generate_babel_tasks-source -->
          
        </div>

        

        
      </div><!-- generate_babel_tasks-method -->

    
      <div id="method-c-get_clouds_to_run_task_on" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_clouds_to_run_task_on</span><span
            class="method-args">(job, profiling_info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_clouds_to_run_task_on-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 275</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_clouds_to_run_task_on</span>(<span class="ruby-identifier">job</span>, <span class="ruby-identifier">profiling_info</span>)
  <span class="ruby-identifier">optimize_for</span> = <span class="ruby-identifier">job</span>[<span class="ruby-value">:optimize_for</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">optimize_for</span> <span class="ruby-operator">==</span> <span class="ruby-value">:performance</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">optimize_for</span> <span class="ruby-operator">==</span> <span class="ruby-value">:cost</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_minimum_val_in_data</span>(<span class="ruby-identifier">job</span>, <span class="ruby-identifier">profiling_info</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_optimal_cloud_for_task</span>(<span class="ruby-identifier">job</span>, <span class="ruby-identifier">profiling_info</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_clouds_to_run_task_on-source -->
          
        </div>

        

        
      </div><!-- get_clouds_to_run_task_on-method -->

    
      <div id="method-c-get_key_from_job_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_key_from_job_data</span><span
            class="method-args">(job)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO(cgb): what is a job’s key?</p>
          

          
          <div class="method-source-code" id="get_key_from_job_data-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 270</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_key_from_job_data</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">job</span>[<span class="ruby-value">:code</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r[\/\.]/</span>, <span class="ruby-string">&quot;&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_key_from_job_data-source -->
          
        </div>

        

        
      </div><!-- get_key_from_job_data-method -->

    
      <div id="method-c-get_minimum_val_in_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_minimum_val_in_data</span><span
            class="method-args">(job, profiling_info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_minimum_val_in_data-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 285</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_minimum_val_in_data</span>(<span class="ruby-identifier">job</span>, <span class="ruby-identifier">profiling_info</span>)
  <span class="ruby-identifier">min_cloud</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">min_val</span> = <span class="ruby-value">1_000_000</span>  <span class="ruby-comment"># infinity</span>
  <span class="ruby-identifier">optimize_for</span> = <span class="ruby-identifier">job</span>[<span class="ruby-value">:optimize_for</span>].<span class="ruby-identifier">to_s</span>

  <span class="ruby-identifier">clouds_to_run_on</span> = []
  <span class="ruby-identifier">job</span>[<span class="ruby-value">:clouds_to_use</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cloud</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># If we have no information on this cloud, then add it to the list</span>
    <span class="ruby-comment"># of clouds we should run the task on, since it could potentially be</span>
    <span class="ruby-comment"># lower than the minimum in the data we've seen so far.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">profiling_info</span>[<span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">to_s</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">clouds_to_run_on</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cloud</span>
      <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">val</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">average</span>(<span class="ruby-identifier">profiling_info</span>[<span class="ruby-identifier">cloud</span>.<span class="ruby-identifier">to_s</span>][<span class="ruby-identifier">optimize_for</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">min_val</span>
      <span class="ruby-identifier">min_cloud</span> = <span class="ruby-identifier">cloud</span>
      <span class="ruby-identifier">min_val</span> = <span class="ruby-identifier">val</span>
    <span class="ruby-keyword">end</span>
  }

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">min_cloud</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">clouds_to_run_on</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">min_cloud</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">clouds_to_run_on</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_minimum_val_in_data-source -->
          
        </div>

        

        
      </div><!-- get_minimum_val_in_data-method -->

    
      <div id="method-c-get_profiling_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_profiling_info</span><span
            class="method-args">(job)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_profiling_info-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 229</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_profiling_info</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-identifier">key</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_key_from_job_data</span>(<span class="ruby-identifier">job</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">NEPTUNE_DATA_DIR</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-constant">NEPTUNE_DATA_DIR</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">profiling_info_file</span> = <span class="ruby-node">&quot;#{NEPTUNE_DATA_DIR}/#{key}.json&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">profiling_info_file</span>)
    <span class="ruby-identifier">contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">profiling_info_file</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>() }
    <span class="ruby-keyword">return</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">contents</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># If we don't have any profiling info on this job, run it locally and</span>
  <span class="ruby-comment"># gather the data ourselves.</span>

  <span class="ruby-identifier">start_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-comment"># TODO(cgb): exec the user's code</span>
  <span class="ruby-identifier">end_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  
  <span class="ruby-comment"># To find out how fast this computer is, just check the file that has</span>
  <span class="ruby-comment"># this info on it and take the first processor. This should be fine</span>
  <span class="ruby-comment"># since we assume the user's code is not-multi-core aware and that</span>
  <span class="ruby-comment"># all processors on this box are the same speed.</span>
  <span class="ruby-identifier">cpu_speed</span> = <span class="ruby-constant">Float</span>(<span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-constant">GET_CPU_INFO</span>).
    <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">%rcpu MHz\s*:\s*(\d+\.\d+)/</span>).<span class="ruby-identifier">flatten</span>[<span class="ruby-value">0</span>])

  <span class="ruby-identifier">json_info</span> = {
    <span class="ruby-string">&quot;total_execution_time&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">end_time</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start_time</span>,
    <span class="ruby-string">&quot;cpu_speed&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cpu_speed</span>
  }

  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">profiling_info_file</span>, <span class="ruby-string">&quot;w+&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> 
    <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span>(<span class="ruby-constant">JSON</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">json_info</span>)) 
  }

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">json_info</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_profiling_info-source -->
          
        </div>

        

        
      </div><!-- get_profiling_info-method -->

    
      <div id="method-c-propogate_credentials_from_environment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">propogate_credentials_from_environment</span><span
            class="method-args">(job)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Searches the caller’s environment variables, and adds any that could be
used in this Exodus job. Only takes in credentials from the environment if
the job does not specify it.</p>
          

          
          <div class="method-source-code" id="propogate_credentials_from_environment-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 195</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">propogate_credentials_from_environment</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-constant">CLOUD_CREDENTIALS</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cloud_name</span>, <span class="ruby-identifier">credential_list</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">credential_list</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cred</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">job</span>[<span class="ruby-value">:credentials</span>][<span class="ruby-identifier">cred</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-constant">ENV</span>[<span class="ruby-identifier">cred</span>.<span class="ruby-identifier">to_s</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">job</span>[<span class="ruby-value">:credentials</span>][<span class="ruby-identifier">cred</span>] = <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">cred</span>.<span class="ruby-identifier">to_s</span>]
      <span class="ruby-keyword">end</span>
    }
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- propogate_credentials_from_environment-source -->
          
        </div>

        

        
      </div><!-- propogate_credentials_from_environment-method -->

    
      <div id="method-c-run_job" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_job</span><span
            class="method-args">(tasks_to_run)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="run_job-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 354</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">run_job</span>(<span class="ruby-identifier">tasks_to_run</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">babel</span>(<span class="ruby-identifier">tasks_to_run</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- run_job-source -->
          
        </div>

        

        
      </div><!-- run_job-method -->

    
      <div id="method-c-validate_clouds_to_use" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_clouds_to_use</span><span
            class="method-args">(job)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Given a single Exodus job, checks to make sure that we can actually run it
in this version of Neptune, and that the user has given us all the 
credentials needed to use that cloud.</p>
          

          
          <div class="method-source-code" id="validate_clouds_to_use-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">validate_clouds_to_use</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ensure_credentials_are_in_correct_format</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">propogate_credentials_from_environment</span>(<span class="ruby-identifier">job</span>)

  <span class="ruby-identifier">job</span>[<span class="ruby-value">:clouds_to_use</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cloud</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">SUPPORTED_CLOUDS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">cloud</span>)
      <span class="ruby-constant">CLOUD_CREDENTIALS</span>[<span class="ruby-identifier">cloud</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">required_credential</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">val_for_credential</span> = <span class="ruby-identifier">job</span>[<span class="ruby-value">:credentials</span>][<span class="ruby-identifier">required_credential</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">val_for_credential</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">val_for_credential</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;To use #{cloud}, &quot;</span> <span class="ruby-operator">+</span>
            <span class="ruby-node">&quot;#{required_credential} must be specified.&quot;</span>)
        <span class="ruby-keyword">end</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{cloud} was specified as in &quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-string">&quot;:clouds_to_use, which is not a supported cloud.&quot;</span>)
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- validate_clouds_to_use-source -->
          
        </div>

        

        
      </div><!-- validate_clouds_to_use-method -->

    
      <div id="method-c-validate_files_argv_executable" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_files_argv_executable</span><span
            class="method-args">(job)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="validate_files_argv_executable-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 220</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">validate_files_argv_executable</span>(<span class="ruby-identifier">job</span>)
  [<span class="ruby-value">:code</span>, <span class="ruby-value">:argv</span>, <span class="ruby-value">:executable</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">param</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">job</span>[<span class="ruby-identifier">param</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{param} was not specified&quot;</span>)
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- validate_files_argv_executable-source -->
          
        </div>

        

        
      </div><!-- validate_files_argv_executable-method -->

    
      <div id="method-c-validate_optimize_for_param" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_optimize_for_param</span><span
            class="method-args">(job)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="validate_optimize_for_param-source">
            <pre><span class="ruby-comment"># File lib/exodus.rb, line 206</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">validate_optimize_for_param</span>(<span class="ruby-identifier">job</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">job</span>[<span class="ruby-value">:optimize_for</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;:optimize_for needs to be &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-string">&quot;specified when running Exodus jobs&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">OPTIMIZE_FOR_CHOICES</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">job</span>[<span class="ruby-value">:optimize_for</span>])
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;The value given for &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-string">&quot;:optimize_for was not an acceptable value. Acceptable values are: &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;#{OPTIMIZE_FOR_CHOICES.join(', ')}&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- validate_optimize_for_param-source -->
          
        </div>

        

        
      </div><!-- validate_optimize_for_param-method -->

    
    </section><!-- public-class-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

